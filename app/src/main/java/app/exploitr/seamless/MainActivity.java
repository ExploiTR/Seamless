package app.exploitr.seamless;

import android.graphics.Bitmap;
import android.graphics.drawable.BitmapDrawable;
import android.os.Bundle;
import android.view.WindowManager;

import androidx.appcompat.app.AppCompatActivity;

import java.util.List;

import app.exploitr.seamless.apps.AppInfo;
import app.exploitr.seamless.databinding.ActivityMainBinding;
import app.exploitr.seamless.graphics.BlurBackgroundDrawable;


public class MainActivity extends AppCompatActivity {

    private ActivityMainBinding binding;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        binding = ActivityMainBinding.inflate(getLayoutInflater());
        setContentView(binding.getRoot());

     //   setBackgroundBlur();
        setAppIcons();
    }

    private void setAppIcons() {
        List<AppInfo.AppDetails> apps = AppInfo.getAllAppDetails(getApplicationContext());
        for (AppInfo.AppDetails app : apps) {
            switch (app.getPackageName()) {
                case "com.google.android.dialer": {
                    binding.topApp.setImageDrawable(app.getIcon());
                    binding.topApp.setOnClickListener(v -> startActivity(app.getLauncherIntent()));
                    break;
                }
                case "com.google.android.apps.messaging": {
                    binding.middleApp.setImageDrawable(app.getIcon());
                    binding.middleApp.setOnClickListener(v -> startActivity(app.getLauncherIntent()));
                    break;
                }
                case "com.android.camera": {
                    binding.bottomApp.setImageDrawable(app.getIcon());
                    binding.bottomApp.setOnClickListener(v -> startActivity(app.getLauncherIntent()));
                    break;
                }
            }
        }
    }

    private void setBackgroundBlur() {
        getWindow().setFlags(WindowManager.LayoutParams.FLAG_LAYOUT_NO_LIMITS, WindowManager.LayoutParams.FLAG_LAYOUT_NO_LIMITS);

        Bitmap bitmap = BlurBackgroundDrawable.getCurrentWallpaperBitmap(this);
        Bitmap wallpaperBitmap;
        if (bitmap != null) {
            wallpaperBitmap = BlurBackgroundDrawable.getBlurBitmap(this, getWindowManager(), bitmap);
            getWindow().setBackgroundDrawable(new BitmapDrawable(getResources(), wallpaperBitmap));
        }
    }
}